<!DOCTYPE html>
<html>
    <head>
        <title>Firefox CORS bug</title>
    </head>
    <body>
        <input type="text" id="url" value="http://fig.org" />
        <button onclick="goFetch(url.value)">Fetch</button>
        <br />
        <textarea id="headers" width="80" height="10">
            None yet.
        </textarea>
        <script type="text/javascript">
        function goFetch(href) {
            var options = {};
            fetch(href, options)
            .then(function (resp) {
                var txt = '';
                resp.headers.forEach(function (val, key) {
                    txt += key + ': ' + val + '\n';
                });
                headers.innerHTML = txt;
                var reader = resp.body.getReader();
                return reader.read();
            })
            .then(function (chunk) {
                var body = String.fromCharCode.apply(String, chunk.value);
                headers.innerHTML = body;
            })
            .catch(function (err) {
                headers.innerHTML = 'Error: ' + err;
            });
        }
        </script>
    </body>
</html>